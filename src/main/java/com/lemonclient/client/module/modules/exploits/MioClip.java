package com.lemonclient.client.module.modules.exploits;

import com.lemonclient.api.setting.values.IntegerSetting;
import com.lemonclient.api.util.world.MotionUtil;
import com.lemonclient.client.module.Category;
import com.lemonclient.client.module.Module;
import net.minecraft.network.play.client.CPacketPlayer.Position;
import net.minecraft.util.math.MathHelper;

@Module.Declaration(
   name = "MioClip",
   category = Category.Exploits
)
public class MioClip extends Module {
   IntegerSetting delay = this.registerInteger("delay", 5, 1, 10);
   IntegerSetting timeout = this.registerInteger("Timeout", 5, 1, 20);
   int ticks = 0;

   public void onDisable() {
      this.ticks = 0;
   }

   public String getHudInfo() {
      return "[" + this.ticks + "]";
   }

   public void onUpdate() {
      if (MotionUtil.moving(mc.field_71439_g)) {
         this.ticks = 0;
      } else {
         ++this.ticks;
         if (this.ticks > (Integer)this.timeout.getValue()) {
            this.disable();
         } else {
            if (mc.field_71441_e.func_184144_a(mc.field_71439_g, mc.field_71439_g.func_174813_aQ().func_72314_b(0.01D, 0.0D, 0.01D)).size() < 2) {
               mc.field_71439_g.func_70107_b(this.roundToClosest(mc.field_71439_g.field_70165_t, Math.floor(mc.field_71439_g.field_70165_t) + 0.301D, Math.floor(mc.field_71439_g.field_70165_t) + 0.699D), mc.field_71439_g.field_70163_u, this.roundToClosest(mc.field_71439_g.field_70161_v, Math.floor(mc.field_71439_g.field_70161_v) + 0.301D, Math.floor(mc.field_71439_g.field_70161_v) + 0.699D));
            } else if (mc.field_71439_g.field_70173_aa % (Integer)this.delay.getValue() == 0) {
               mc.field_71439_g.func_70107_b(mc.field_71439_g.field_70165_t + MathHelper.func_151237_a(this.roundToClosest(mc.field_71439_g.field_70165_t, Math.floor(mc.field_71439_g.field_70165_t) + 0.241D, Math.floor(mc.field_71439_g.field_70165_t) + 0.759D) - mc.field_71439_g.field_70165_t, -0.03D, 0.03D), mc.field_71439_g.field_70163_u, mc.field_71439_g.field_70161_v + MathHelper.func_151237_a(this.roundToClosest(mc.field_71439_g.field_70161_v, Math.floor(mc.field_71439_g.field_70161_v) + 0.241D, Math.floor(mc.field_71439_g.field_70161_v) + 0.759D) - mc.field_71439_g.field_70161_v, -0.03D, 0.03D));
               mc.field_71439_g.field_71174_a.func_147297_a(new Position(mc.field_71439_g.field_70165_t, mc.field_71439_g.field_70163_u, mc.field_71439_g.field_70161_v, true));
               mc.field_71439_g.field_71174_a.func_147297_a(new Position(this.roundToClosest(mc.field_71439_g.field_70165_t, Math.floor(mc.field_71439_g.field_70165_t) + 0.23D, Math.floor(mc.field_71439_g.field_70165_t) + 0.77D), mc.field_71439_g.field_70163_u, this.roundToClosest(mc.field_71439_g.field_70161_v, Math.floor(mc.field_71439_g.field_70161_v) + 0.23D, Math.floor(mc.field_71439_g.field_70161_v) + 0.77D), true));
            }

         }
      }
   }

   private double roundToClosest(double num, double low, double high) {
      double d2 = high - num;
      double d1 = num - low;
      return d2 > d1 ? low : high;
   }
}
